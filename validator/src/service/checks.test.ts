import { describe, expect, it } from "vitest";
import { buildSafeTransactionCheck } from "./checks.js";

describe("checks", () => {
	describe("buildSafeTransactionCheck", () => {
		it("should allow owner change", async () => {
			const check = buildSafeTransactionCheck();
			check.check({
				to: "0xF01888f0677547Ec07cd16c8680e699c96588E6B",
				value: 0n,
				data: "0xe318b52b0000000000000000000000002dc63c83040669f0adba5f832f713152ba862c97000000000000000000000000e7f8c378df23ebb06d5fc5a33bd471ef510f8cc9000000000000000000000000baf055b4ae60b897649f654df8def87bb4f86299",
				operation: 0,
				nonce: 0n,
				chainId: 100n,
				account: "0xF01888f0677547Ec07cd16c8680e699c96588E6B",
			});
		});

		it("should allow multisend with calls to other contracts", async () => {
			const check = buildSafeTransactionCheck();
			check.check({
				to: "0x40A2aCCbd92BCA938b02010E17A5b8929b49130D",
				value: 0n,
				data: "0x8d80ff0a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000046b00469788fe6e9e9681c6ebf3bf78e7fd26fc01544600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044bd86e508736166652e657468000000000000000000000000000000000000000000000000000000000000000000000000d101ee8ab789b5ac467cd0c5343ac596e074e7a900a0b937d5c8e32a80e3a8ed4227cd020221544ee6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c4bf6213e4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000005bacaa20000000000000000000000000000000000000000000000017097071d7b566000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000109203d17922f539fb574e5e1f6d90465148bd7db15545841b8f3b4abe9df5d040e7dab6bf83b5e440418b27e82fcc724f0ff2dba673de766816c49b4c929b00c327b5754ca9c08cadb9ffdfe5a5207796d9be48d869dd0c500515774c0747e0087ffeb9bfa892a609ef0e4d8e56906cc226ebcdeed2e0956a1f8a510df63fa4704fa0478c551520b05243f319f13c8b0b2cd9fb5f6d2167906639eed96af45357c66521c5276873caaec751f783a1f5b8bf1a4721b6edddbe6f1c6461415f139915eb66ee9f44732b9861438a746c644967878a71a6242baa91d4487be75fb4cf0a6d3701dcb0b97559583b1aa2421882d56318b02c6c007abd359479775873df9fea2b42423550759e89e535b4d4e161e8fb2d863e5b60c01358a14197089be5b56c4486661ebec5747ec78d3ffac59923102c6a5d54c5defa08537873b7c82435fe35c5adc5c483754e6a5a344ae2ebdfa8c45aeaa13f577077674a91a947638b4fca97dbd562b4bce9c318eb9b985ea30aebe29cae941811e93425cc14762280ac2a9f69aebd287a893dc0efc0b5021b8ee3669877d200138fbf8fd4bb71fb64c7556587b8b27dd506cc48f6667566a8899de7a16e64f8c9c4c931bce8ebddc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470260ff1ff6ec89ea0b57028c682d3d1bdd86c9f393863a04e52b4b82ca363cbf700a0b937d5c8e32a80e3a8ed4227cd020221544ee6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000640087b83f5a5721848b2fa4cf4d2b8e3c7df9882952036c5ed24d31f5b1c71352252dcc93000000000000000000000000f01888f0677547ec07cd16c8680e699c96588e6b00000000000000000000000000000000ffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000",
				operation: 1,
				nonce: 0n,
				chainId: 1n,
				account: "0xF01888f0677547Ec07cd16c8680e699c96588E6B",
			});
		});

		it("should allow multisend with multiple owner changes", async () => {
			const check = buildSafeTransactionCheck();
			check.check({
				to: "0x40A2aCCbd92BCA938b02010E17A5b8929b49130D",
				value: 0n,
				data: "0x8d80ff0a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000022b0081a45aa50195f0a752159d5198780cdfb8e1973200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064e318b52b0000000000000000000000003242071b0b406b6661af2de1115cd46567ab091700000000000000000000000007e5069f8f8e6a80432b13f20e9d4906de097e1a000000000000000000000000d80e356e94fb3f8e85b39b0c730fb7152e8cbd800081a45aa50195f0a752159d5198780cdfb8e1973200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064f8dc5dd9000000000000000000000000d80e356e94fb3f8e85b39b0c730fb7152e8cbd80000000000000000000000000070941a8e2d7289e9594798f65a9379f6828d5bb00000000000000000000000000000000000000000000000000000000000000020081a45aa50195f0a752159d5198780cdfb8e1973200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064f8dc5dd90000000000000000000000005afe8f36504462aa6a7467372f9a41665820a14f000000000000000000000000c0ffeee8baafa7ba6a6af2329892b88796cf44cf0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000",
				operation: 1,
				nonce: 0n,
				chainId: 1n,
				account: "0x81a45AA50195f0A752159d5198780cDfb8e19732",
			});
		});

		it("should allow singleton upgrade", async () => {
			const check = buildSafeTransactionCheck();
			check.check({
				to: "0x526643F69b81B008F46d95CD5ced5eC0edFFDaC6",
				value: 0n,
				data: "0xed007fc6",
				operation: 1,
				nonce: 0n,
				chainId: 1n,
				account: "0x81a45AA50195f0A752159d5198780cDfb8e19732",
			});
		});

		it("should not allow bybit transaction", async () => {
			const check = buildSafeTransactionCheck();
			expect(() =>
				check.check({
					to: "0x96221423681A6d52E184D440a8eFCEbB105C7242",
					value: 0n,
					data: "0xa9059cbb000000000000000000000000bdd077f651ebe7f7b3ce16fe5f2b025be29695160000000000000000000000000000000000000000000000000000000000000000",
					operation: 1,
					nonce: 0n,
					chainId: 1n,
					account: "0x1db92e2EeBC8E0c075a02BeA49a2935BcD2dFCF4",
				}),
			).toThrow("Delegatecall not allowed");
		});
	});
});
